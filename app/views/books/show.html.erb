
<div class="page-header">
  <h1><%= @book.title %></h1>
  <%= link_to "Back", books_path, class: "btn btn-back" %>
</div>

<section class="book-info">
  <p><strong>Author:</strong> <%= @book.author %></p>
  <p><strong>Description:</strong> <%= @book.description %></p>
  <%= image_tag @book.display_image, alt: @book.title, class: "book-image" %>
  <h3>Average Rating:</h3>
  <div class="star-rating">
    <% (1..5).reverse_each do |star| %>
      <span class="star"><%= star <= @book.average_rating.round ? "★" : "☆" %></span>
    <% end %>
  </div>


  <% if authenticated? %>
    <div class="book-actions">
      <%= link_to "Edit", edit_book_path(@book), class: "btn btn-edit" %>
      <%= button_to "Delete", @book, method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn btn-delete" %>
    </div>
  <% end %>
</section>

<section class="comments-section">
  <h2>Comments</h2>

  <% if @book.comments.any? %>
    <div class="comments">
      <% @book.comments.each do |comment| %>
        <div class="comment">
          <p><strong><%= comment.user.name if comment.user %></strong></p>
          <p><%= comment.content %></p>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="no-comments">No comments yet.</p>
  <% end %>

  <% if authenticated? %>

    <h3>Rate this Book:</h3>
    <%= form_with url: book_ratings_path(@book), method: :post, local: true, class: "rating-form" do |form| %>
      <div class="star-rating">
        <% (1..5).reverse_each do |star| %>
          <%= radio_button_tag :rating, star, (params[:rating] || @rating&.rating).to_i == star, id: "rating_#{star}", class: "hidden-radio" %>
          <%= label_tag "rating_#{star}", "★" %>
        <% end %>
      </div>
      <%= form.submit "Submit Rating", class: "form-submit" %>
    <% end %>

    <h3>Add a Comment</h3>

    <%= form_with(model: [@book, @book.comments.build], local: true, class: "comment-form") do |form| %>
      <div class="form-group">
        <%= form.text_area :content, class: "form-input" %>
      </div>
      <%= form.submit "Post Comment", class: "form-submit" %>
    <% end %>

  <% end %>
</section>
